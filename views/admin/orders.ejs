<%- include('../partials/header') %>

<h2 style="text-align:center;margin:30px 0;font-size:28px;">Orders</h2>

<table border="1" width="95%" style="margin:auto;border-collapse:collapse;font-size:15px;">
    <tr style="background:#f1f1f1;font-weight:bold;text-align:center;">
        <td>ID</td>
        <td>Name</td>
        <td>Phone</td>
        <td>Address</td>
        <td>Distance</td>
        <td>Delivery Fee</td>
        <td>Location</td>
        <td>Total</td>
        <td>Items</td>
        <td>Date</td>
        <td>Action</td>
    </tr>

    <% orders.forEach(order => { %>
    <tr style="text-align:center;">
        <td><%= order.id %></td>
        <td><%= order.customer_name %></td>
        <td><%= order.customer_phone %></td>
        <td><%= order.customer_address || "N/A" %></td>

        <!-- Delivery Distance -->
        <td>
            <%= order.delivery_distance ? order.delivery_distance + " km" : "N/A" %>
        </td>

        <!-- Delivery Fee -->
        <td>Rs <%= order.delivery_fee || 0 %></td>

        <!-- Google Map Location -->
        <td>
            <% if(order.delivery_lat && order.delivery_lng){ %>
                <a href="https://www.google.com/maps?q=<%= order.delivery_lat %>,<%= order.delivery_lng %>"
                   target="_blank"
                   style="background:#007bff;color:#fff;padding:6px 12px;border-radius:5px;text-decoration:none;display:inline-block;">
                    üìç View Map
                </a>
            <% } else { %>
                <span style="color:#888;">No GPS</span>
            <% } %>
        </td>

        <!-- Total -->
        <td>Rs <%= order.total %></td>

        <!-- Item Count -->
        <td>
            <% let items = (typeof order.items === "string" ? JSON.parse(order.items) : order.items); %>
            <%= items.length %> item(s)
        </td>

        <!-- Date -->
        <td><%= new Date(order.created_at).toDateString() %></td>

        <!-- Delete -->
        <td>
            <form action="/admin/orders/delete/<%= order.id %>" method="POST" style="display:inline;">
                <button style="background:red;color:white;border:none;padding:6px 10px;border-radius:4px;cursor:pointer;">
                    Delete
                </button>
            </form>
        </td>
    </tr>
    <% }) %>
</table>

<%- include('../partials/footer') %>
