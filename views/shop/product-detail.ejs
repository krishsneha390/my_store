<%- include('../partials/header') %>
<%- include("../partials/navbar") %>

<style>
    .gallery-container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .main-image {
        width: 420px;
        height: 420px;
        object-fit: contain;
        border-radius: 10px;
        cursor: zoom-in;
        margin-bottom: 15px;
    }

    .thumb-row {
        display: flex;
        gap: 12px;
    }

    .thumb {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        opacity: 0.8;
        border: 2px solid transparent;
    }

    .thumb:hover {
        opacity: 1;
        border-color: #007bff;
    }

    /* Lightbox popup */
    .lightbox {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    .lightbox img {
        max-width: 90%;
        max-height: 90%;
        border-radius: 12px;
    }
</style>


<div style="max-width:1200px;margin:auto;padding:40px;display:flex;gap:50px;flex-wrap:wrap;">

    <!-- IMAGE GALLERY -->
    <div class="gallery-container">

        <% 
            const images = [product.image, product.image2, product.image3].filter(i => i);
        %>

        <!-- Main Image -->
        <img id="mainImage" 
             src="<%= images[0].startsWith('http') ? images[0] : '/uploads/' + images[0] %>"
             class="main-image"
             onclick="openLightbox(this.src)"
        >

        <!-- Thumbnails -->
        <div class="thumb-row">
            <% images.forEach(img => { %>
                <img 
                    src="<%= img.startsWith('http') ? img : '/uploads/' + img %>"
                    class="thumb"
                    onclick="document.getElementById('mainImage').src = this.src"
                >
            <% }) %>
        </div>
    </div>


    <!-- PRODUCT INFO -->
    <div style="flex:1;min-width:300px;">

        <h2 style="font-size:30px;font-weight:700;margin-bottom:10px;">
            <%= product.name %>
        </h2>

        <p style="font-size:24px;font-weight:bold;color:#007bff;margin-bottom:20px;">
            Rs <%= product.price %>
        </p>

        <div style="font-size:17px;line-height:1.6;margin-bottom:25px;">
            <%- product.description.replace(/<img[^>]*>/g, "") %>
        </div>

        <form action="/add-to-cart/<%= product.id %>" method="POST">
            <button style="background:#007bff;color:white;padding:14px 26px;font-size:18px;
                           border:none;border-radius:6px;cursor:pointer;">
                üõí Add to Cart
            </button>
        </form>

        <a href="/" style="display:inline-block;margin-top:20px;padding:10px 20px;border:2px solid #333;
                           border-radius:6px;color:#333;text-decoration:none;font-size:17px;">
            ‚Üê Back to Shop
        </a>
    </div>
</div>


<!-- LIGHTBOX POPUP -->
<div id="lightbox" class="lightbox" onclick="closeLightbox()">
    <img id="lightboxImg" src="">
</div>

<script>
    function openLightbox(src) {
        document.getElementById("lightboxImg").src = src;
        document.getElementById("lightbox").style.display = "flex";
    }

    function closeLightbox() {
        document.getElementById("lightbox").style.display = "none";
    }
</script>


<%- include('../partials/footer') %>
